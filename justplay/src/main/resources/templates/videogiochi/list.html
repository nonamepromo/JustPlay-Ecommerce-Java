<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
	layout:decorate="~{layout/layout}">

<body>

	<!-- main -->
	<div layout:fragment="content">

		<script>
			function listWithPlatform(platform, index) {
				window.location.href = "list?platform=" + platform + "&index=" + index;
			}
		</script>

		<script>
			function openDetails(idVideogioco) {
				window.location.href = "details?idVideogioco=" + idVideogioco;
			}
		</script>

		<script>
			function addGameToWishlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/addGameToWishlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						console.log("urlParams")
						const queryString = window.location.search
						const urlParams = new URLSearchParams(queryString);
						console.log(urlParams)
						// window.open("list?index=" + urlParams.get('index'), "_self")
						window.open("list?platform=" + urlParams.get('platform') + "&index=" + urlParams.get('index'), "_self")
					},
					error: function (response) {
						console.log("errore")
					}
				});
			}
		</script>

		<script>
			function removeGameFromWishlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/removeGameFromWishlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						console.log("urlParams")
						const queryString = window.location.search
						const urlParams = new URLSearchParams(queryString);
						// window.open("list?index=" + urlParams.get('index'), "_self")
						window.open("list?platform=" + urlParams.get('platform') + "&index=" + urlParams.get('index'), "_self")
					}
				});
			}
		</script>

		<script>
			function addGameToPlayedlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/addGameToPlayedlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						console.log("urlParams")
						const queryString = window.location.search
						const urlParams = new URLSearchParams(queryString);
						// window.open("list?index=" + urlParams.get('index'), "_self")
						window.open("list?platform=" + urlParams.get('platform') + "&index=" + urlParams.get('index'), "_self")
					}
				});
			}
		</script>

		<script>
			function removeGameFromPlayedlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/removeGameFromPlayedlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						const queryString = window.location.search
						const urlParams = new URLSearchParams(queryString);
						window.open("list?platform=" + urlParams.get('platform') + "&index=" + urlParams.get('index'), "_self")
						//window.open('list?platform=all&index=2', "_self")
					}
				});
			}
		</script>

		<section class="p-t-30">
			<div class="container">
				<div class="alert alert-danger" role="alert" th:text="#{common.errore.title}" th:if="${error}">
				</div>
				<div class="toolbar-custom">
					<form th:action="@{/videogiochi/list?platform=all&index=1}" method="post"
						class="float-left cold-12 col-sm-6 p-l-0 p-r-10">
						<div class="input-group mb-3">
							<input th:value="${searchString}" name="searchString" th:placeholder="#{videogioco.ricerca}"
								class="form-control" maxlength="100"
								style="border-top-right-radius: 0px; border-bottom-right-radius: 0px;">
							<div class="input-group-append">
								<button class="btn btn-light" type="submit"
									style="border-top-left-radius: 0px; border-bottom-left-radius: 0px;"><i
										class="fa fa-search"></i></button>
							</div>
						</div>
					</form>
					<div class="btn-group float-right m-l-5 hidden-sm-down" role="group">
						<a class="btn btn-default btn-icon"
							th:classappend="${param.platform != null} ? (${param.platform[0] == 'all'} ? 'active' : '') : ''"
							href="#" role="button"
							th:onclick="|listWithPlatform('all', 1)|">[[#{videogioco.filtroAll}]]</a>
						<a class="btn btn-default btn-icon"
							th:classappend="${param.platform != null} ? (${param.platform[0] == 'ps4'} ? 'active' : '') : ''"
							href="#" role="button" th:onclick="|listWithPlatform('ps4', 1)|">Playstation 4</a>
						<a class="btn btn-default btn-icon"
							th:classappend="${param.platform != null} ? (${param.platform[0] == 'xbox'} ? 'active' : '') : ''"
							href="#" role="button" th:onclick="|listWithPlatform('xbox', 1)|">Xbox One</a>
						<a class="btn btn-default btn-icon"
							th:classappend="${param.platform != null} ? (${param.platform[0] == 'pc'} ? 'active' : '') : ''"
							href="#" role="button" th:onclick="|listWithPlatform('pc', 1)|">Pc</a>
					</div>
				</div>
				<div class="row mb-3" th:if="${isResearch}"
					th:text="${isResearch} ? 'Risultati per: ' +  ${searchString} : ''"></div>
				<div class="row">
					<div th:each="videogioco : ${videogiochi}" class="col-12 col-sm-6 col-md-4">
						<div class="card card-lg">
							<div class="card-img">
								<a th:onclick="|openDetails('${videogioco.id}')|">
									<img style="height: 268px; object-fit: cover;" th:src="${videogioco.imageUrl}"
										class="card-img-top">
								</a>
								<div th:classappend="${wishList != null} ? (${wishList.contains(videogioco)} ? 'card-liked' : 'card-likes') : 'card-likes'"
									style="bottom: -43px; right: 60px">
									<a th:onclick="${wishList != null} ? (${wishList.contains(videogioco)} ? |removeGameFromWishlist('${videogioco.id}')| : |addGameToWishlist(${videogioco.id})|) : |href='@{/common/login}'|"
										th:style="${wishList != null} ? (${wishList.contains(videogioco)} ? 'color: red' : 'color: light-grey') : 'color: light-grey'"></a>
								</div>
								<div th:classappend="${playedList != null} ? (${playedList.contains(videogioco)} ? 'card-played' : 'card-plays') : 'card-plays'"
									style="bottom: -43px;">
									<a th:onclick="${playedList != null} ? (${playedList.contains(videogioco)} ? |removeGameFromPlayedlist('${videogioco.id}')| : |addGameToPlayedlist('${videogioco.id}')|) : |href='@{/common/login}'|"
										th:style="${playedList != null} ? (${playedList.contains(videogioco)} ? 'color: red' : 'color: light-grey') : 'color: light-grey'"></a>
								</div>
							</div>
							<div class="card-block" style="height: 133px;">
								<div th:if="${videogioco.ps4Url != null}" class="badge badge-ps4"
									style="position: relative; bottom: 13px;">Ps4</div>
								<div th:if="${videogioco.xboxUrl != null}" class="badge badge-xbox-one"
									style="position: relative; bottom: 13px;">Xbox One</div>
								<div th:if="${videogioco.pcUrl != null}" class="badge"
									style="position: relative; bottom: 13px;" th:classappend="badge-steam">Pc</div>
								<h4>
									<a th:onclick="|openDetails('${videogioco.id}')|" th:text="${videogioco.titolo}">
									</a>
								</h4>
								<div class="card-meta">
									<span th:text="${videogioco.annoDiUscita}"> </span>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div th:if="!${isResearch}" class="pagination-results m-t-0">
					<nav aria-label="Page navigation">
						<ul class="pagination">
							<li th:each="i: ${#numbers.sequence(1, videogiochiCount)}" class=""
								th:class="${param.index != null} ? (${param.index[0] == i} ? 'page-item active' : 'page-item') : 'page-item active'">
								<a th:text="${i}" class="page-link" th:data-parameter1="${platform}" th:onclick="|listWithPlatform(this.getAttribute('data-parameter1'), ${i})|"></a>
							</li>
						</ul>
					</nav>
				</div>

				<div th:if="${isResearch}" class="pagination-results m-t-0">
					<nav aria-label="Page navigation">
						<ul class="pagination">
							<li th:each="i: ${#numbers.sequence(1, videogiochiCount)}" class=""
								th:class="${param.index != null} ? (${param.index[0] == i} ? 'page-item active' : 'page-item') : 'page-item active'">
								<a th:if="${i} != 0" th:text="${i}" class="page-link" th:href="@{'/videogiochi/list?platform=all&index='+ ${i} + '&searchString=' + ${searchString}}"></a>
							</li>
						</ul>
					</nav>
				</div>
			</div>
		</section>
	</div>


</body>

</html>