<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
	layout:decorate="~{layout/layout}">

<body>

	<!-- main -->
	<div layout:fragment="content">
		<!-- <script>
			function listWithIndex(index) {
				window.location.href = "list?index=" + index;
			}
		</script> -->

		<script>
			function listWithPlatform(platform, index) {
				window.location.href = "list?platform=" + platform + "&index=" + index;
			}
		</script>

		<script>
			function openDetails(idVideogioco) {
				window.location.href = "details?idVideogioco=" + idVideogioco;
			}
		</script>

		<script>
			function addGameToWishlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/addGameToWishlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						// console.log( "ciao")
						// const queryString = window.location.search
						// const urlParams = new URLSearchParams(queryString);
						// window.open("list?index=" + urlParams.get('index'), "_self")
						window.open('list?platform=all&index=1', "_self")
					},
					error: function (response) {
						console.log( "errore")
					}
				});
			}
		</script>

		<script>
			function removeGameFromWishlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/removeGameFromWishlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						// const queryString = window.location.search
						// const urlParams = new URLSearchParams(queryString);
						// window.open("list?index=" + urlParams.get('index'), "_self")
						window.open('list?platform=all&index=1', "_self")
					}
				});
			}
		</script>

		<script>
			function addGameToPlayedlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/addGameToPlayedlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						// const queryString = window.location.search
						// const urlParams = new URLSearchParams(queryString);
						// window.open("list?index=" + urlParams.get('index'), "_self")
						window.open('list?platform=all&index=1', "_self")
					}
				});
			}
		</script>

		<script>
			function removeGameFromPlayedlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/removeGameFromPlayedlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						// const queryString = window.location.search
						// const urlParams = new URLSearchParams(queryString);
						// window.open("list?index=" + urlParams.get('index'), "_self")
						window.open('list?platform=all&index=1', "_self")
					}
				});
			}
		</script>

		<!-- <script type="text/javascript">

      function checkIfGameIsDesired() {

        $.ajax({
          type: "GET",
          url: '[(@{/videogiochi/checkIfGameIsDesidered})]',
          data: 'idUtente=' + 1 + '&idVideogioco=' + 4,
          success: function (response) {
            return response;
          }
        });
      };

    </script> -->

		<section class="p-t-30">
			<div class="container">
				<div class="toolbar-custom">
					<form method="post" class="float-left cold-12 col-sm-6 p-l-0 p-r-10">
						<div class="form-group input-icon-right">
							<i class="fa fa-search"></i>
							<input type="text" class="form-control search-game" placeholder="Cerca videogioco...">
						</div>
					</form>
					<div class="dropdown float-left">
						<!-- <select th:onchange="|listWithPlatform(this.value, 1)|" class="form-control">
							<div class="dropdown-menu dropdown-menu-right">
								<option class="dropdown-item" th:onclick="|listWithIndex(1)|">Tutte le piattaforme
								</option>
								<option class="dropdown-item" th:value="ps4">Playstation 4</option>
								<option class="dropdown-item" th:value="xbox">Xbox One</option>
								<option class="dropdown-item" th:value="pc">Pc</option>
							</div>
						</select> -->

					</div>

					<div class="btn-group float-right m-l-5 hidden-sm-down" role="group">
						<a class="btn btn-default btn-icon" th:classappend="${param.platform != null} ? (${param.platform[0] == 'all'} ? 'active' : '') : ''"
							href="#" role="button" th:onclick="|listWithPlatform('all', 1)|">Tutte le piattaforme</a>
						<a class="btn btn-default btn-icon" th:classappend="${param.platform != null} ? (${param.platform[0] == 'ps4'} ? 'active' : '') : ''"
							href="#" role="button" th:onclick="|listWithPlatform('ps4', 1)|">Playstation 4</a>
						<a class="btn btn-default btn-icon" th:classappend="${param.platform != null} ? (${param.platform[0] == 'xbox'} ? 'active' : '') : ''"
							href="#" role="button" th:onclick="|listWithPlatform('xbox', 1)|">Xbox One</a>
						<a class="btn btn-default btn-icon" th:classappend="${param.platform != null} ? (${param.platform[0] == 'pc'} ? 'active' : '') : ''"
							href="#" role="button" th:onclick="|listWithPlatform('pc', 1)|">Pc</a>
					</div>

					<div class="dropdown float-right">
						<!-- <button class="btn btn-default" type="button" data-toggle="dropdown" aria-haspopup="true"
							aria-expanded="true">Date Added <i class="fa fa-caret-down"></i></button>
						<div class="dropdown-menu dropdown-menu-right">
							<a class="dropdown-item active" href="#">Date Added</a>
							<a class="dropdown-item" href="#">Popular</a>
							<a class="dropdown-item" href="#">Newest</a>
							<a class="dropdown-item" href="#">Oldest</a>
						</div> -->
					</div>
				</div>
				<div class="row">
					<div class="alert alert-success" role="alert" th:text="#{common.operazioneok}" th:if="${success}">
					</div>
					<div th:each="videogioco : ${videogiochi}" class="col-12 col-sm-6 col-md-4">
						<div class="card card-lg">
							<div class="card-img">
								<a th:onclick="|openDetails('${videogioco.id}')|">
									<img style="height: 268px; object-fit: cover;" th:src="${videogioco.imageUrl}"
										class="card-img-top">
								</a>
								<div th:classappend="${wishList != null} ? (${wishList.contains(videogioco.id)} ? 'card-liked' : 'card-likes') : 'card-likes'"
									style="bottom: -43px; right: 60px">
									<a th:onclick="${wishList != null} ? (${wishList.contains(videogioco.id)} ? |removeGameFromWishlist('${videogioco.id}')| : |addGameToWishlist(${videogioco.id})|) : |javascript:location.href='@{/common/login}'|"
										th:style="${wishList != null} ? (${wishList.contains(videogioco.id)} ? 'color: red' : 'color: light-grey') : 'color: light-grey'"></a>
								</div>
								<div th:classappend="${playedList != null} ? (${playedList.contains(videogioco.id)} ? 'card-played' : 'card-plays') : 'card-plays'"
									style="bottom: -43px;">
									<a th:onclick="${playedList != null} ? (${playedList.contains(videogioco.id)} ? |removeGameFromPlayedlist('${videogioco.id}')| : |addGameToPlayedlist('${videogioco.id}')|) : |javascript:location.href='@{/common/login}'|"
										th:style="${playedList != null} ? (${playedList.contains(videogioco.id)} ? 'color: red' : 'color: light-grey') : 'color: light-grey'"></a>
								</div>
							</div>
							<div class="card-block" style="height: 133px;">
								<div th:if="${videogioco.ps4Url != null}" class="badge badge-ps4"
									style="position: relative; bottom: 13px;">Ps4</div>
								<div th:if="${videogioco.xboxUrl != null}" class="badge badge-xbox-one"
									style="position: relative; bottom: 13px;">Xbox One</div>
								<div th:if="${videogioco.pcUrl != null}" class="badge"
									style="position: relative; bottom: 13px;" th:classappend="badge-steam">Pc</div>
								<h4>
									<a th:onclick="|openDetails('${videogioco.id}')|" th:text="${videogioco.titolo}">
									</a>
								</h4>
								<div class="card-meta">
									<span th:text="${videogioco.annoDiUscita}"> </span>
									<!-- <a th:with="fullQueryString=${#request.queryString}+'&lang=it'" th:href="${fullQueryString}">ciaooo</a> -->
								</div>
								<!-- <p th:text="${videogioco.descrizione}" class="card-text" style="overflow: hidden; text-overflow: ellipsis;
   		 			white-space: nowrap;"></p> -->
							</div>
						</div>
					</div>

				</div>

				<div class="pagination-results m-t-0">
					<nav aria-label="Page navigation">
						<ul class="pagination">
							<li class="page-item disabled"><a class="page-link" href="#" aria-label="Previous"><span
										aria-hidden="true"><i class="fa fa-angle-left"></i></span></a></li>
							<li th:each="i: ${#numbers.sequence(1, videogiochiCount)}" class=""
								th:class="${param.index != null} ? (${param.index[0] == i} ? 'page-item active' : 'page-item') : 'page-item active'">
								<!-- <a th:text="${i}" class="page-link" th:data-parameter1="${param.platform[0]}" th:onclick="|listWithPlatform(this.getAttribute('data-parameter1'), ${i})|"></a> -->
								<a th:text="${i}" class="page-link" th:data-parameter1="${platform}" th:onclick="|listWithPlatform(this.getAttribute('data-parameter1'), ${i})|"></a>
							</li>
							<!-- <li th:with="someVariable=${param.platform[0]}" th:text="${someVariable}"></li> -->
							<!-- <li class=""
								th:class="${param.index != null} ? (${param.index[0] == '2'} ? 'page-item active' : 'page-item') : 'page-item'">
								<a class="page-link" th:onclick="|listWithIndex(2)|">2</a>
							</li>
							<li class=""
								th:class="${param.index != null} ? (${param.index[0] == '3'} ? 'page-item active' : 'page-item') : 'page-item'">
								<a class="page-link" th:onclick="|listWithIndex(3)|">3</a>
							</li> -->
							<!-- <li th:each="i: ${#numbers.sequence(1, videogiochiCount)}" class="page-item"><a
									th:text="${i}" class="page-link" href="#"></a></li> -->
							<li class="page-item"><a class="page-link" href="#" aria-label="Next"><span
										aria-hidden="true"><i class="fa fa-angle-right"></i></span></a></li>
						</ul>
					</nav>
				</div>
			</div>
		</section>
	</div>


</body>

</html>