<!DOCTYPE html>
<html xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" xmlns:th="http://www.thymeleaf.org"
	layout:decorate="~{layout/layout}">

<body>

	<!-- main -->
	<div layout:fragment="content">
		<script>
			function removeGameFromSellinglist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/removeGameFromSellinglist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						// const queryString = window.location.search
						// const urlParams = new URLSearchParams(queryString);
						// window.open("details?idVideogioco=" + urlParams.get('index'), "_self")
						window.open('details?idVideogioco=' + idVideogioco, "_self")
					}
				});
			}
		</script>

		<script>
			function addGameToLikedlist(idVideogioco) {
				$.ajax({
					url: '[(@{/videogiochi/addGameToLikedlist})]',
					type: "POST",
					data: 'idVideogioco=' + idVideogioco,
					success: function (response) {
						console.log("urlParams")
						const queryString = window.location.search
						const urlParams = new URLSearchParams(queryString);
						console.log(urlParams)
						window.open("details?idVideogioco=" + idVideogioco, "_self")
					},
					error: function (response) {
						console.log("errore")
					}
				});
			}
		</script>

		<section class="hero hero-game"
			th:style="'background:url('+ ${videogioco.imageUrl} +'); background-size: 1262px;'">
			<input type="hidden" th:value="${idVideogioco}" th:name="idVideogioco" class="form-control">

			<div class="overlay"></div>
			<div class="container">
				<div class="hero-block">
					<div class="hero-left">
						<h2 th:text="${videogioco.titolo}" class="hero-title"></h2>
					</div>
					
					<!-- LA FORM O SI USA JS, NEL DUBBIO LASCIO TUTTI E DUE -->
					<form th:action="@{/videogiochi/addGameToLikedlist}">
						<button type="submit">Prova Bottone</button>
					</form>
					<div class="hero-right">
						<a th:onclick="|addGameToLikedlist(${videogioco.id})|">Prova</a>
					</div>
					
				</div>
			</div>
		</section>

		<section class="post">
			<div class="container">
				<div class="alert alert-success" role="alert" th:text="#{common.operazioneok}" th:if="${success}"></div>
				<div class="alert alert-danger" role="alert" th:text="#{common.errore.title}" th:if="${error}"></div>
				<!-- Button trigger modal -->
				<button type="button" class="btn btn-primary btn-shadow btn-rounded" data-toggle="modal"
					data-target="#modal-login">[[#{videogioco.vendita}]]<i class="fa fa-shopping-cart"></i></button>
				<div class="modal fade" id="modal-login">
					<div class="modal-dialog modal-sm" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title"><i class="fa fa-shopping-cart"></i>
									[[#{videogioco.venditaPrivata}]]</h5>
								<button type="button" class="close" data-dismiss="modal" aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body p-a-20">
								<form th:action="@{/videogiochi/addGameToSellinglistProva}"
									th:object="${videogioco_in_vendita}" method="post">

									<div class="input-group mb-3">
										<input type="hidden" th:value="${idVideogioco}" th:name="idVideogioco"
											class="form-control">
										<input type="hidden" th:value="${idUtente}" th:name="idUtente"
											class="form-control">
										<input type="hidden" th:value="${amazon}" th:name="amazon" class="form-control">
										<input type="hidden" th:value="${gamestop}" th:name="gamestop"
											class="form-control">
									</div>

									<h4 th:text="${videogioco.titolo}"></h4>
									<div class="divider"></div>
									<div class="form-group input-icon-left m-b-10">
										<i class="fa fa-dollar"></i>
										<input type="number" class="form-control form-control-secondary"
											th:field="*{prezzo}" th:placeholder="#{videogioco.venditaPrezzo}" required>
									</div>
									<div class="form-group input-icon-left m-b-10">
										<i class="fa fa-plane"></i>
										<input type="number" class="form-control form-control-secondary"
											th:field="*{prezzoSpedizione}"
											th:placeholder="#{videogioco.venditaSpedizione}">
									</div>
									<div class="form-group input-icon-left m-b-15">
										<i class="fa fa-map-signs"></i>
										<input type="text" class="form-control form-control-secondary"
											th:field="*{provincia}" th:placeholder="#{videogioco.venditaLuogo}"
											required>
									</div>
									<div class="dropdown float-left">
										<select class="form-control" name="piattaforma" required>
											<div class="dropdown-menu dropdown-menu-right">
												<option selected disabled hidden>[[#{videogioco.venditaPiattaforma}]]
												</option>
												<option value="PS4" th:if="${videogioco.ps4Url != null}" th:value="PS4"
													class="dropdown-item">PS4</option>
												<option value="Xbox" th:if="${videogioco.xboxUrl != null}"
													th:value="Xbox" class="dropdown-item">Xbox</option>
												<option value="Pc" th:if="${videogioco.pcUrl != null}" th:value="Pc"
													class="dropdown-item">Pc</option>
											</div>
										</select>
										<div class="divider"></div>
									</div>
									<button type="submit" th:text="#{common.submit}"
										class="btn btn-primary btn-block m-t-10"> <i class="fa fa-sign-in"></i></button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>

		<section class="p-t-10">
			<div class="container">
				<div class="row">
					<div class="col-lg-8">
						<!-- post -->
						<div class="mb-5" th:if="${amazon == null && gamestop == null}">
							<h4 th:text="#{videogioco.storeNo}"></h4>
						</div>
						<div th:if="${amazon != null || gamestop != null}">
							<h4 th:text="#{videogioco.storeYes}"></h4>
						</div>
						<div th:if="${amazon} != null" class="mt-4 mb-4">
							<div class="post">
								<a class="col-md-4" th:href="${amazon.amazonUrl}" target="_blank">
									<img class="mt-3"
										src="https://www.kanguru.it/wp-content/uploads/2017/09/amazon-logo.png"
										style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
								</a>
								<a class="col-md-2 mt-3" th:href="${amazon.amazonUrl}" target="_blank">
									<h4 th:text="${amazon.prezzoAmazon} + €"></h4>
								</a>
							</div>
						</div>

						<div th:if="${gamestop} != null" class="mt-4 mb-4">
							<div class="post">
								<a class="col-md-4" th:href="${gamestop.url}" target="_blank">
									<img class="mt-3" src="https://www.gamestop.it/Views/Locale/Content/Images/logo.png"
										style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
								</a>
								<a class="col-md-2 mt-3" th:href="${gamestop.url}" target="_blank">
									<h4 th:text="${gamestop.prezzo} + €"></h4>
								</a>
							</div>
						</div>
						<div th:if="${ps4Urls} != null" class="mt-4 mb-4">
							<div class="post">
								<span class="badge badge-ps4">Ps4</span>
								<div th:each="ps4Url : ${ps4Urls}" class="row">
									<a class="col-md-4" th:href="${ps4Url}" target="_blank">
										<img class="mt-3" th:if="${ps4Url.contains('amazon')}"
											src="https://www.kanguru.it/wp-content/uploads/2017/09/amazon-logo.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
										<img class="mt-3" th:if="${ps4Url.contains('unieuro')}"
											src="https://upload.wikimedia.org/wikipedia/it/thumb/b/b3/Unieuro_Logo_2015.png/1200px-Unieuro_Logo_2015.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
										<img class="mt-3" th:if="${ps4Url.contains('mediaworld')}"
											src="https://www.mediaworld.it/frontend/2018-11/MediaWorld_Logo_1.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
									</a>
									<a class="col-md-2 mt-3" th:href="${ps4Url}" target="_blank">
										<h4>15,99 €</h4>
									</a>
								</div>
							</div>
						</div>
						<div th:if="${xboxUrls} != null" class="mt-4 mb-4">
							<div class="post">
								<span class="badge badge-xbox">Xbox One</span>
								<div th:each="xboxUrl : ${xboxUrls}" class="row">
									<a class="col-md-4" th:href="${xboxUrl}" target="_blank">
										<img class="mt-3" th:if="${xboxUrl.contains('amazon')}"
											src="https://www.kanguru.it/wp-content/uploads/2017/09/amazon-logo.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
										<img class="mt-3" th:if="${xboxUrl.contains('unieuro')}"
											src="https://upload.wikimedia.org/wikipedia/it/thumb/b/b3/Unieuro_Logo_2015.png/1200px-Unieuro_Logo_2015.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
										<img class="mt-3" th:if="${xboxUrl.contains('mediaworld')}"
											src="https://www.mediaworld.it/frontend/2018-11/MediaWorld_Logo_1.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
									</a>
									<a class="col-md-2 mt-3" th:href="${xboxUrl}" target="_blank">
										<h4>15,99 €</h4>
									</a>
								</div>
							</div>
						</div>
						<div th:if="${pcUrls} != null" class="mt-4 mb-4">
							<div class="post">
								<span class="badge badge-steam">Pc</span>
								<div th:each="pcUrl : ${pcUrls}" class="row">
									<a class="col-md-4" th:href="${pcUrl}" target="_blank">
										<img class="mt-3" th:if="${pcUrl.contains('amazon')}"
											src="https://www.kanguru.it/wp-content/uploads/2017/09/amazon-logo.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
										<img class="mt-3" th:if="${pcUrl.contains('unieuro')}"
											src="https://upload.wikimedia.org/wikipedia/it/thumb/b/b3/Unieuro_Logo_2015.png/1200px-Unieuro_Logo_2015.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
										<img class="mt-3" th:if="${pcUrl.contains('mediaworld')}"
											src="https://www.mediaworld.it/frontend/2018-11/MediaWorld_Logo_1.png"
											style="display: block; max-width:160px; max-height:35px; width: auto; height: auto;">
									</a>
									<a class="col-md-2 mt-3" th:href="${pcUrl}" target="_blank">
										<h4>15,99 €</h4>
									</a>
								</div>
							</div>
						</div>
						<div th:if="${sellingList.contains(videogioco.id)}">
							<!-- post -->
							<div class="post">
								<h4 th:text="#{videogioco.privata}"></h4>
							</div>
							<div class="post">
								<table class="table table-hover">
									<thead>
										<tr>
											<!-- <th>Utente</th> -->
											<th th:text="#{videogioco.prezzo}"></th>
											<th th:text="#{videogioco.spedizione}"></th>
											<th th:text="#{videogioco.provincia}"></th>
											<th th:text="#{profilo.piattaformagioco}"></th>
											<th th:text="#{profilo.azioni}"></th>
										</tr>
									</thead>
									<tbody>
										<tr th:each=" videogioco_in_vendita : ${videogiochi_in_vendita}">
											<td th:text="${videogioco_in_vendita.prezzo}+ '€'"></td>
											<td th:text="${videogioco_in_vendita.prezzoSpedizione}+ '€'"></td>
											<td th:text="${videogioco_in_vendita.provincia}"></td>
											<td th:text="${videogioco_in_vendita.piattaforma}"></td>
											<td th:if="${videogioco_in_vendita.fkUtente == idUtente}">
												<a class="btn btn-link p-a-5"
													th:onclick="|removeGameFromSellinglist('${idVideogioco}')|"><i
														class="fa fa-trash-o"></i></a>
											</td>
											<td th:if="${videogioco_in_vendita.fkUtente != idUtente}">
												<form th:action="@{/videogiochi/createConversazione}">
													<input type="hidden" th:value="${videogioco_in_vendita.fkUtente}"
														th:name="fkUtente" class="form-control">
													<button type="submit" class="btn btn-link p-a-5"><i
															class="fa fa-wechat"></i></button>
												</form>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
					<div class="col-lg-4">
						<!-- sidebar -->
						<div class="sidebar">
							<!-- widget game -->
							<div class="widget widget-game">
								<div class="widget-block"
									style="background-image: url('https://img.youtube.com/vi/U75Qkzc2tqA/maxresdefault.jpg')">
									<div class="overlay"></div>
									<div class="widget-item">
										<h4 th:text="${videogioco.titolo}"></h4>
										<span th:text="${videogioco.annoDiUscita}" class="meta"></span>

										<h5 th:text="#{profilo.piattaformagioco}"></h5>
										<a th:if="${videogioco.ps4Url != null}" href="#"><span
												class="badge badge-ps4">Ps4</span></a>
										<a th:if="${videogioco.xboxUrl != null}" href="#"><span
												class="badge badge-xbox-one">Xbox
												One</span></a>
										<a th:if="${videogioco.pcUrl != null}" href="#"><span
												class="badge badge-steam">Pc</span></a>

										<h5></h5>
										<ul>
											<li><a></a></li>
											<li><a></a></li>
										</ul>

										<h5>Descrizione</h5>
										<p th:text="${videogioco.descrizione}"></p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>
	<!-- /main -->

	<!-- plugins js -->
	<script src="plugins/lightbox/lightbox.js" th:src="@{/plugins/lightbox/lightbox.js}"></script>
	<script src="plugins/sticky/jquery.sticky.js" th:src="@{/plugins/sticky/jquery.sticky.js}"></script>
	<script src="plugins/easypiechart/jquery.easing.1.3.js"
		th:src="@{/plugins/easypiechart/jquery.easing.1.3.js}"></script>
	<script src="plugins/easypiechart/jquery.easypiechart.min.js"
		th:src="@{/plugins/easypiechart/jquery.easypiechart.min.js}"></script>
	<script th:inline="javascript">
		(function ($) {
			"use strict";
			// easyPieChart
			$('.chart').easyPieChart({
				barColor: '#5eb404',
				trackColor: '#e3e3e3',
				easing: 'easeOutBounce',
				onStep: function (from, to, percent) {
					$(this.el).find('span').text(Math.round(percent));
				}
			});

			// lightbox
			$('[data-lightbox]').lightbox({
				disqus: 'gameforestyakuzieu'
			});
		})(jQuery);
	</script>
</body>

</html>